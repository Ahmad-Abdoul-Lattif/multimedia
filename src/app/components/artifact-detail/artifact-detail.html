<!-- src/app/components/artifact-detail/artifact-detail.html -->

<div class="detail-container" *ngIf="artifact() as art">
  <!-- Back Button -->
  <button class="back-button" (click)="goBack()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    Retour
  </button>

  <!-- Hero Section with 3D Viewer -->
  <section class="hero-section">
    <div class="viewer-container" *ngIf="show3DViewer()">
      <div class="viewer-wrapper">
        <iframe 
          *ngIf="sketchfabUrl()"
          [src]="sketchfabUrl()!"
          class="sketchfab-iframe"
          frameborder="0" 
          allow="autoplay; fullscreen; xr-spatial-tracking" 
          xr-spatial-tracking 
          execution-while-out-of-viewport 
          execution-while-not-rendered 
          web-share
          allowfullscreen
        ></iframe>
        <div class="viewer-overlay">
          <div class="viewer-controls">
            <button class="control-btn" title="Plein écran">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
              </svg>
            </button>
          </div>
          <div class="viewer-info">
            <span class="viewer-badge">Visualisation 3D Interactive</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Alternative Image View -->
    <div class="image-container" *ngIf="!show3DViewer()">
      <img [src]="art.thumbnail" [alt]="art.title">
    </div>

    <!-- Toggle Button -->
    <button class="toggle-view-btn" (click)="toggleViewer()">
      <svg *ngIf="show3DViewer()" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <circle cx="9" cy="9" r="2"/>
        <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
      </svg>
      <svg *ngIf="!show3DViewer()" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
        <line x1="12" y1="22.08" x2="12" y2="12"/>
      </svg>
      {{ show3DViewer() ? 'Image 2D' : 'Modèle 3D' }}
    </button>
  </section>

  <!-- Content Section -->
  <section class="content-section">
    <div class="content-wrapper">
      <!-- Main Info -->
      <div class="main-info">
        <div class="category-tag" [style.background-color]="getCategoryColor(art.category)">
          {{ art.category }}
        </div>
        <h1 class="artifact-title">{{ art.title }}</h1>
        <p class="artifact-subtitle">{{ art.artist }} • {{ art.period }}</p>
        
        <!-- Quick Facts -->
        <div class="quick-facts">
          <div class="fact-item">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <div>
              <span class="fact-label">Année</span>
              <span class="fact-value">{{ art.year }}</span>
            </div>
          </div>
          
          <div class="fact-item" *ngIf="art.materials">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
            <div>
              <span class="fact-label">Matériaux</span>
              <span class="fact-value">{{ art.materials }}</span>
            </div>
          </div>
          
          <div class="fact-item" *ngIf="art.dimensions">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
            </svg>
            <div>
              <span class="fact-label">Dimensions</span>
              <span class="fact-value">{{ art.dimensions }}</span>
            </div>
          </div>
        </div>

        <!-- Description -->
        <div class="description-section">
          <h2 class="section-title">Description</h2>
          <p class="description-text">{{ art.description }}</p>
        </div>

        <!-- Highlights -->
        <div class="highlights-section" *ngIf="art.highlights && art.highlights.length > 0">
          <h2 class="section-title">Points remarquables</h2>
          <ul class="highlights-list">
            <li *ngFor="let highlight of art.highlights" class="highlight-item">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20 6 9 17 4 12"/>
              </svg>
              {{ highlight }}
            </li>
          </ul>
        </div>
      </div>

      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="info-card">
          <h3 class="card-title">Informations</h3>
          <div class="info-list">
            <div class="info-row">
              <span class="info-label">Artiste</span>
              <span class="info-value">{{ art.artist }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Période</span>
              <span class="info-value">{{ art.period }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Catégorie</span>
              <span class="info-value">{{ art.category }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Date</span>
              <span class="info-value">{{ art.year }}</span>
            </div>
          </div>
        </div>

        <div class="share-card">
          <h3 class="card-title">Partager</h3>
          <div class="share-buttons">
            <button class="share-btn" title="Partager">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="18" cy="5" r="3"/>
                <circle cx="6" cy="12" r="3"/>
                <circle cx="18" cy="19" r="3"/>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
              </svg>
            </button>
            <button class="share-btn" title="Favori">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
              </svg>
            </button>
            <button class="share-btn" title="Télécharger">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
            </button>
          </div>
        </div>
      </aside>
    </div>
  </section>

  <!-- Related Artifacts -->
  <section class="related-section" *ngIf="relatedArtifacts().length > 0">
    <div class="related-wrapper">
      <h2 class="section-title">Œuvres similaires</h2>
      <div class="related-grid">
        <div 
          *ngFor="let related of relatedArtifacts()"
          class="related-card"
          (click)="navigateToArtifact(related.id)"
        >
          <div class="related-image">
            <img [src]="related.thumbnail" [alt]="related.title" loading="lazy">
            <div class="related-overlay">
              <span class="view-text">Voir l'œuvre</span>
            </div>
          </div>
          <div class="related-info">
            <h3 class="related-title">{{ related.title }}</h3>
            <p class="related-artist">{{ related.artist }}</p>
            <p class="related-period">{{ related.period }}</p>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="isLoading()">
  <div class="spinner"></div>
  <p>Chargement de l'artefact...</p>
</div>